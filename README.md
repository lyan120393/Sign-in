# Sign-in Project

Sign-in Project for members who work in Popo

Todo List:

3.  签到签出页面 归纳为 personal page.
    签入按钮
    签出按钮
    小吃,饮料, note 的显示.
4.  用户个人页面
    修改密码
5.  查询页面
    查询工作记录, 统计结果等等

6.  数据统计的路由
    根据某一段时间的进行统计, 统计工作时间, 统计小吃.
7.  服务器功能待更新
    3.  账号权限检查, 如果是 Manager 账号,可以查看更多的内容(所有员工的记录, 手动修改时间的记录,更多功能待补充)
    4.  员工账号只能查看自身的工作时间, 无法查看其他人的时间记录.
    5.  时间预测(客户端 Js), 通过当前的时间, 选择最接近的 5 的倍数的时间.
    6.  统计功能, 统计指定时间内的工作时长, 小吃, 饮料等内容.
    7.  时间自动终止功能, 防止忘记 signOut 造成错误.
    8.  所有被人为手动调整过时间的记录, manual 的布尔值都设置为 true, 证明被修改过.
    9.  留言板功能, 分为员工留言板和 manager 留言板.
    10. 查看本周总班表----当前需要手动输入每个人的工作时长.(未来可能考虑使用电脑排班)
    11. 下次工作时段提醒, 显示下次自己需要工作的时间段.
    12. \*GPS 地理位置范围判断, 这个功能在研究下怎么弄.
    13. \*仓库拿货, 超市扫货, 送餐派送的统计.
    14. 商店参数需要写到程序当中.

next todo:

1. - [x]留言板路由

   1. - [x]创建一个店铺的模型
      1. 包含字段: 店铺名称(区别于 moscow 店), 营业时间开始于结束(用于自动签出), GPS 和阈值暂时不写因为还不知道怎么写, 留言板( manager, kitchen, front, 需要包含签到时间和文本和谁留的言), 本周员工总体班表(), 店铺排班相关的暂时不写, 店铺缺货列表(未来等开发到这个功能)), 店铺的各种配方的谁知道如何制作.
   2. - [x]创建一个新店铺的实例
   3. - [x]可以让具有权限的员工去进行修改留言板的内容, 保留编辑时间和编辑员工.
      - [x]添加新的用户字段, belongStore, 用于区分员工所属于哪一个商店.
      - []目前没有写路由用于设置员工的所属商店, 存储的是商店的 id, 所以都是通过手动方式去给用户设定所属商店.
   4. - [x]读取, 修改留言的内容, 根据权限.都可以读取.
      - [x]但是修改时需要权限的.

2. 下次工作时段提醒路由 [暂时不觉得这个功能有多么的实在, 延后开发]

   1. 从店铺实例当中获得本周的总班表
      - []创建一个可以提交的本周总班表的路由, 如果可能的话存成数组(可以存放很多周的班表以供以后查看)
   2. 从总班表当中找到自己的班表,
   3. - [x]根据此时此刻的日期推算出距离下次工作最近的 moment 数字,
   4. - [x]然后把得到的数字渲染出去.(每次 request, 就会更新一次下次的工作时间.)
   5. - [x]如果当前的时间位于工作时段之间, 则显示 工作中...
   6. 如果当前的时间超过某一个工作时段的截止时间, 显示下一次可用的工作时段.
   7. - []创建新的路由, 用于接收班表
   8. - []字段信息, 本周周一的日期(通常讲 Monday, 用于匹配对应的周), 用户名, 工作日是一个数组,包含最多 7 个元素,每个元素是一天(星期几(可以是数字, 也可以是文字), 开始时间( HH:mm), 结束时间( HH:mm)))

3. - []创建班表查询路由, 根据用户名称, 或者是本周开始的日期查看个人整周班表,以及所有人的整周班表.
4. - []解决用户直接访问/ me 导致的问题, 即使没有 token 也会进入该页面, 并查看到默认的数据.

2018/9/27

1. - []增加 signOut 功能.
2. - []**而且 signOut 必须晚于 signIn**

2018/9/26

1. - [x]修复签到之后, 时间在服务器上的时间和实际的时间不相符的 bug. 使用 moment.utcOffset("+00:00")给 client JS 即可.
2. - [x]修复 Statistic 页面用户输入的日期的显示不是很友好的问题, 需要把 year 这一行放在下一行, 确保位置正确.

2018/9/21

1. - [x]有一个故障, 就是点击 signOut 或者 signIn 的时间之后, 下方的 table 表格不会把最新的记录显示出来.
2. - [x]完成 me, statistic 页面的用户不合法输入验证功能, 并把错误提示信息进行显示在屏幕上.
3. 创建一个专门判断日期月份, 年份, 日期的 validator. 都是整数, 且月份为 1-12, 年份为今年, 日期为 1-31 之间.
4. 创建一个专门判断小时 和 分钟数 的 validator. 都是整数, 最早上午 10 点, 最晚是晚上 23 点. 分钟数为 0 - 59 之间的整数,不写就是 0.
5. 创建一个专门判断 apptizer 和 drink 数量为数字的 validator, 必须是整数, 且数值为 0-4 之间, 不写就是 0.
6. 修复多次点击 Statistic 页面的 search 按钮会出现的重复并叠加渲染相同的数据的 bug
7. 把 app.js 上所有的 console.log 设置为 注释, 防止服务器运行时一堆信息弹出来.
8. 在客户端的 function.js 当中添加了三个 validator, 分别验证日期, 时间, 小吃.

2018/9/20

1. - [x]点击 me 页面的 more date 的日期的页面, 根据用户输入的区间范围去搜索工作记录, 以及统计.
2. - [x]研究如何使用 bootstrap 进行页面数据验证.
3. 修改用户提交表格带有 input-group-prepend 的样式, 并且重新调整表格, 可以被很好的查看.
4. 修复了 setAttribute("class", "d-none")使用时可能会导致的 bug.
5. 完成了对所有页面的 Javascript 文件的定义 serverAddress. 现在可一个根据这个值去调整服务器的网络位置, 为上传至服务器做准备.
6. 修复了所有页面点击 POPO logo 时候的行为是不同的.
7. 完成了统计页面, 可以根据输入内容的区间范围去显示总体时长和总体的饮料+小吃的数量, 还可以显示区域时间内的工作日志.
8. 修复创建用户的时候, belongStore 字段不存在的问题, 现在如果没有给员工 sign 店铺, 那么 belongStore 会显示 Not Given.
9. 给 login, reg, 页面的 不合法数据的验证功能, 并把错误的提示信息显示在页面上.

2018/9/19

1. 完成移动两个 edit 和 delete 按钮, 放置在 table 的后面.
2. 完成 edit 和 delete 按钮连接服务器.
3. edit 会弹出 modal, 并且在弹出的表格中, 可以带有之前签到的记录.
4. delete 按钮点击之后即可进行删除.
5. 修改了 people 的 deleteandsavetheday 功能, 之前的是异步的, 会导致偶尔出现数据被误删的情况.
6. 修改了 /deleteRecord 服务器路由接受的数据内容, 进行了更加合理化的数据输入.

2018/9/18

1. 完成 resign 按钮以及 modal 的 submit 按钮连接至服务器.
2. 根据服务器返回的签到日期去进行判断, 如果这个日子是最近 7 天之内的, 那么我们需要再次给 period 路由发送请求.
3. 根据 period 路由最新返回的内容, 通过 firstCHild 和 removeChild 去进行清除页面原有内容, 并重新 renderMe 进行渲染.
4. signIn 的 modal 和 signOut 的 modal 现在都连接到了服务器的指定路由上, 工作正常.

2018/9/14

1. 现在 /editcheck 路由会查找指定日期的记录, 如果找到会把整个工作日的全部内容返回给用户
2. 现在 /user/editMessageBoard 路由一旦用户提交了新的内容, 会重新把最新的内容发送给用户
3. 只做了三个 modal , 一个给 messageboard 的编辑页面, 另外的两个是给 signIn 和 signOut 按钮的 modal.
4. 现在 People 的 toJson 功能, 也可以返回 role 的相关信息, 这样可以根据用户权限去让用户修改留言板.
5. Store 的 editMessage 功能被进行了修改, 可以返回全部的 messageBoard 信息.
6. 修复渲染 me 页面的时候, mins 由于小数点导致的超多位数, 目前只精确到整数分钟位.
7. checkSignIn 功能可以向服务器的 /editcheck 路由发送请求, 查看某一日是否有签到记录.
8. 完成 me 页面的 renderMe 这个功能, 在页面载入的时候,根据传入的数据时段不同, 分别进行渲染页面上的内容.
9. 完成计算前一个或者后一个为 5 的倍数的时间计算功能, 如果此时时间是 12:21, 那么 before 就是 12:20, after 就是 12:25.
10. nearTime 功能可以根据 pass in 的 moment() 时间去计算 after 和 before 时间.
11. 完成点击按钮 signIn, signOut 之后的逻辑判断, 可以根据 checkSignIn 功能的结果正确显示需要看到的 Modal 信息.
12. 完成三个 messageboard 的 edit 按钮的点击之后的操作. 使用一个 modal 根据点击的按钮不同进行修改内容.
13. 完成 messageBoard 的 modal 的提交修改内容的按钮的逻辑, 点击提交之后会自动 hide modal, 并重新刷新页面.

2018/9/13

1. 把页面上的按钮 edit Record 和 delete Record 的位置进行移除, 打算放在 table 的尾部方便去操作指定的 table.
2. 完成 messageBoard 的三个编辑按钮的控制逻辑, 并能够弹出 modal 进行输入内容, 检查用户权限进行提交并更新.
3. 学习和研究 modal 的使用, 以及如何通过 modal 输入信息, 发送信息给服务器, 并最终重新渲染页面.

2018/9/11

1. 完成了 personal page 页面的内容渲染,
   其中包括 welcome 提示,
   messageBoard,
   clock In 的 message 区域,
   工作记录区间时间的显示
   工作记录的信息显示, 增加了 date 字段显示
2. 清除模板页面不需要的冗余信息
3. 修改了 personal Page 上面的 MessageBoard 的颜色效果, 更容易阅读
4. 优化了留言板信息的显示, 现在是 XXX 职位的 XXX 在 XXXX 时间段说了什么.
5. people 的 toJson 现在会返回 username 字段了.
6. 新增了 functions.js, 目前包含关于本地存储字段的读取, 存入, 清除等操作.

2018/9/9

1. 整理了 me.js 页面加载时对于/ user/me 的路由使用, 直接向相关的路由发送多条请求拿到数据.

2018/9/8

1. 完成 personal Page 模板页面的整体.
2. 尝试学习在页面加载的时候, 向两个服务器路由发起请求, 并得到回复.
3. 心得: 了解/me 这个模板页面路由 和 /user/me 服务器功能路由之间的不同.(体现在页面加载时请求的是功能路由, 而页面跳转的时候使用的是模板路由)
4. 把 personal page 将要使用到的大量的按钮的基础按钮功能,整理出来.
5. 对 /user/me 路由进行深刻改造, 现在已经可以返回 messageBoard 里面的信息和 clock In 之后的提示信息的内容.
6. 了解到 CSP 错误有可能是因为模板页面的缩进错误导致, 也有可能是由于路有指向错误导致.(2019/9/5)
7. toUnix 功能是当 pass 的参数为空的时候 toUnix(), 才会启用参数默认值
8. 制作了一个简单的 footer 的样式
9. 尝试制作可以提交用户每周工作班表的路由, 但是没有制作完成,这个可以放在之后的开发当中.

2018/8/31

1. 完成留言板的全部路由

   1. - [x]留言板路由
      1. - [x]创建一个店铺的模型
         1. 包含字段: 店铺名称(区别于 moscow 店), 营业时间开始于结束(用于自动签出), GPS 和阈值暂时不写因为还不知道怎么写, 留言板( manager, kitchen, front, 需要包含签到时间和文本和谁留的言), 本周员工总体班表(), 店铺排班相关的暂时不写, 店铺缺货列表(未来等开发到这个功能)), 店铺的各种配方的谁知道如何制作.
         2. - [x]创建一个新店铺的实例
         3. - [x]可以让具有权限的员工去进行修改留言板的内容, 保留编辑时间和编辑员工.
         - [x]添加新的用户字段, belongStore, 用于区分员工所属于哪一个商店.
         - []目前没有写路由用于设置员工的所属商店, 存储的是商店的 id, 所以都是通过手动方式去给用户设定所属商店.
         4. - [x]读取, 修改留言的内容, 根据权限.都可以读取.
         - [x]但是修改时需要权限的.

2. - [x]修改 signIn 和 signOut 成功之后返回的 message 信息内容.
3. - [x]修改 resign 连接 和 edit 路由, 一旦被用户手动设置过, 需要把 manualEdit 字段设置为 true.

2018/8/26

1. fix login and register page's Unexplected token problems
2. make javascript run when page loading
3. receive token from server, send token cross different page, and send token back to receive correct result,
4. finish design personal page"
5. 账号激活, 账号需要激活之后才能够登录
6. 账号登录成功之后, 才会发 Token, 注册完不发 Token. 如果未激活,无法成功登陆,并提示.
7. 注册页面完成.
8. 注册成功后的等待页面完成.

2018/8/22:
/\*
增删改查

1. 增
   当日增加:签到签出(标准常规签到)
   补签:过去日期的补签 (提供签到时间, 签出时间, 小吃, 饮料, note )直接操作数据库签到.补签需要带有一个记录.
2. 删除
   删除指定日期的工作记录(提供签到日期),根据签到日找到当天的记录进行删除
3. 改 /edit
   修改指定日期(提供日期), 查询当日是否有签到记录.
   如果有记录,根据日期进行修改.
   如果没有告诉没有记录无法修改.
4. 查询
   查询某日的工作记录(使用/ editcheck 路由)
   查询某段时间的工作记录(工作这里)
   输入肯定是两个时间点, 计算包含这两个时间点以及在他们之间的时间点的元素.
   \*/
